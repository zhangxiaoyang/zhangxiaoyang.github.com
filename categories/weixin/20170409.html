<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="description" content="Yang的后花园，爱美工的程序员，zhangxiaoyang"/>
    <meta name="keywords" content="学习，思考，想法"/>
    <meta name="author" content="zhangxiaoyang"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <title>Yang的后花园</title>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="/themes/default/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <meta name="google-site-verification" content="Fjy6iUBWNJ0NBNFFzR8ZxFrkCxJ9rvHeBBYPyue-HBw"/>
<link rel="stylesheet" type="text/css" href="/themes/default/css/scrollUp.css"/>
<link rel="stylesheet" type="text/css" href="/themes/default/css/prettify-solarized-dark.css"/>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?661930a9db32b395d0caee1a2c022527";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46826647-1', 'auto');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div id="container">
      <div id="wrap">
        <header id="header">
          <div id="banner" style="background: url(http://ww3.sinaimg.cn/large/005X3nNxjw1epeyfkp54aj30sg0fr0tj.jpg) no-repeat center center; background-size: cover;">
          </div>
          <div id="header-outer" class="outer">
            <div id="header-title" class="inner">
              <div class="logo">
                <img src="https://avatars3.githubusercontent.com/u/2735163?v=3&amp;s=460" alt="Profile Picture">
              </div>
              <div id="title">
                爱美工的程序员
              </div>
              <ul class="my-navigation">
                
                <li>
                  <a href="/index.html" title="Home">
                  <i class="fa fa-home" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
                <li>
                  <a href="/category.html" title="Category">
                  <i class="fa fa-th-large" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
                <li>
                  <a href="/about.html" title="About">
                  <i class="fa fa-user" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
                <li>
                  <a href="/rss.xml" title="RSS">
                  <i class="fa fa-rss" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
          <div id="header-inner" class="">
            <nav id="title-nav" style="display: none;">
              <span id="title-nav-items">
                
                  <a href="/index.html" title="Home">
                    <i class="fa fa-home"></i>
                  </a>
                
                  <a href="/category.html" title="Category">
                    <i class="fa fa-th-large"></i>
                  </a>
                
                  <a href="/about.html" title="About">
                    <i class="fa fa-user"></i>
                  </a>
                
                  <a href="/rss.xml" title="RSS">
                    <i class="fa fa-rss"></i>
                  </a>
                
              </span>
            </nav>
            <nav id="sub-nav">
              <a id="nav-search-btn" class="nav-icon" title="Search">
              </a>
            </nav>
            <div id="search-form-wrap">
              <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8"
              class="search-form">
                <input type="search" name="word" maxlength="20" class="search-form-input"
                placeholder="搜索">
                <input type="submit" value="" class="search-form-submit">
                <input name="tn" type="hidden" value="bds">
                <input name="cl" type="hidden" value="3">
                <input name="ct" type="hidden" value="2097152">
                <input type="hidden" name="si" value="zhangxiaoyang.me">
              </form>
            </div>
          </div>
        </header>

<div class="outer">
  <section id="main">
    <article id="weixin/20170409" class="article article-type-post"
    itemscope="" itemprop="blogPost">
      <div class="article-inner">
        <header class="article-header">
          <h1 itemprop="name">
            <a class="article-title" href="/categories/weixin/20170409.html">
              字符编码那些事儿
            </a>
          </h1>
        </header>
        <footer class="article-footer">
          <ul class="article-time-list">
            <li class="article-time-list-item">
              <a class="article-time-list-link" href="/archive.html">
                2017-04-09 21:01:00
              </a>
            </li>
          </ul>
          <br/>
          <ul class="article-category-list">
            <li class="article-category-list-item">
              <a class="article-category-list-link" href="/category.html">
                微信备份
              </a>
            </li>
          </ul>
          <br/>
          <ul class="article-tag-list">
            
              <li class="article-tag-list-item">
                <a class="article-tag-list-link" href="/tag.html">
                  UNICODE
                </a>
              </li>
            
              <li class="article-tag-list-item">
                <a class="article-tag-list-link" href="/tag.html">
                  UTF-8
                </a>
              </li>
            
          </ul>
        </footer>
        <div class="article-entry" itemprop="articleBody">
          <div class="article-abstract"><p><img src="/drafts/categories/weixin/images/unicode-banner.jpg" alt=""></p>
<p>你有没有被编码整过？</p>
</div>
<h2 id="1-">1 引子</h2>
<p>如何将信息交给计算机处理呢？</p>
<p>首先要解决“交”的问题，即让计算机“拿到”这些信息，这个过程便是编码。</p>
<p>有两种很重要的信息：数字、字符。</p>
<p>对于数字来说，编码似乎要简单很多，因为数字天然会有一个二进制的表示。举个栗子，用1个字节存储“5”：<code>5(10) = 101(2) =&gt; 0000 0101</code>。</p>
<p>但是，现实也并非那么美好。比如，我们有一个数字“-5”，或者数字“0.5”，或者数字“555555555”，会面临以下问题。</p>
<ul>
<li>如何编码这个数字？（编码方法）</li>
<li>使用几个字节编码？（编码长度）</li>
<li>会不会有一些数字编码不了？（编码范围）</li>
</ul>
<p>字符编码，同样有这些问题。</p>
<h2 id="2-">2 字符编码</h2>
<h3 id="2-1-">2.1 字符编码与数字编码</h3>
<p>没有数字到二进制转换的天然性，字符编码的思路是先把字符映射到一个数字，然后再将数字映射到存储的二进制。</p>
<p>映射字符到数字的表格，被称作字符集（Character Set），微软称其为代码页（Code Page），又叫内码。字符集里的每一个字符都有一个编号，即映射到的数字，被称作码点（Code Point）。</p>
<p>数字是具有全球性的，大家都认，1就是1，2就是2。但是，字符中的大部分文字却没有这个特性。比如，拿汉字“诗”给老外看，他根本不知道也不关心这是啥意思。所以，就有了针对各种语言的字符集。</p>
<ul>
<li><p>GB2312、GBK、GB18030 - 中文</p>
</li>
<li><p>BIG5 - 中文繁体</p>
</li>
<li><p>KS X 1001、EUC-KR、ISO-2022-KR - 韩文</p>
</li>
<li><p>JIS X 0208 - 日文</p>
</li>
</ul>
<p>这里就有一个问题了，这些字符集会不会在表示各自文字的时候用到相同的码点？答案是肯定的，这也是乱码的一个原因。</p>
<pre><code class="lang-python">  &gt;&gt;&gt; c = &#39;诗&#39;
  &gt;&gt;&gt; print c.decode(&#39;gbk&#39;)
  诗
  &gt;&gt;&gt; print c.decode(&#39;big5&#39;)
  坅
</code></pre>
<h3 id="2-2-ascii-">2.2 ASCII编码</h3>
<p>ASCII（American Standard Code for Information Interchange）编码是美国制定的一套字符编码方案，字符集中有0~127共计128个码点，每一个码点都可以使用7位二进制表示。编码方式非常直接，就是码点对应的二进制。</p>
<p><img src="/drafts/categories/weixin/images/ascii.png" alt=""></p>
<p>查看一个英文字符“a”对应的ASCII字符集的码点和ASCII编码：</p>
<pre><code class="lang-python">&gt;&gt;&gt; ord(u&#39;a&#39;.encode(&#39;ascii&#39;))
97
&gt;&gt;&gt; bin(ord(u&#39;a&#39;.encode(&#39;ascii&#39;)))
&#39;0b1100001&#39;
</code></pre>
<p>因为计算机是按字节分配内存的，尽管ASCII字符集的码点只需要7位，实际上要占用一个字节。所以，有2^8-2^7=128个字符空间是没有用到的。</p>
<p>后来，为了解决部分西欧语言的问题，有人想到利用这剩下的128来表示更多的字符，这些方法统称为EASCII（Extended ASCII），其中著名的有ISO 8859-1（又称作Latin 1）。</p>
<h3 id="2-3-gb-xxx-">2.3 GB XXX编码</h3>
<p>对于汉字来说，ASCII剩下的128个字符显然是不够用的。</p>
<p>这难不倒我们，GB2312率先出场。GB2312收录了共7445个图形字符，其中汉字占6763个。显然码点的个数已经超出了1个字节的表示范围，所以使用两个字节来编码一个汉字。</p>
<p>考虑到与ASCII的兼容，规定码点在0~127范围内的字符和ASCII相同，还是1个字节表示1个字符。</p>
<pre><code class="lang-python">&gt;&gt;&gt; ord(u&#39;a&#39;.encode(&#39;gb2312&#39;))
97
</code></pre>
<p>规定两个码点大于127的字符连在一起时，表示一个汉字。首字节需要在0xA1到 0xF7之间，尾字节在0xA1到0xFE之间，这样可以组合出8000多种码点。</p>
<pre><code class="lang-python">&gt;&gt;&gt; print u&#39;诗&#39;.encode(&#39;gb2312&#39;)
&#39;\xca\xab&#39;
</code></pre>
<p>由于GB2312只收录6763个汉字，还有不少汉字并未有收录。于是微软基于GB2312扩展出GBK。GBK共收录21886个汉字和图形符号，其中汉字21003 个。GBK的首字节在0x81到0xFE 之间，尾字节在0x40到0xFE 之间，一共有2万多个码点。</p>
<p>机智的你有没有猜到，GB是Guo Biao（国标）的意思，K是Kuo Zhan（扩展）的意思...</p>
<p>再后来，GB18030推出，兼容GB2312，基本兼容GBK，共收录汉字70244个。GB18030采用了多字节编码方案，支持更大的编码空间。</p>
<h2 id="3-unicode-utf-xxx">3 UNICODE与UTF-XXX</h2>
<h3 id="3-1-unicode">3.1 UNICODE</h3>
<p>ASCII作为一个开始，后面出现了各种字符集，各种编码方案。貌似，我们在自己的世界里玩得很好。</p>
<p>事实上，如果把字符集比作是一部字典，那现在的情况是，我的字典里未必有你，你的字典里未必有我。</p>
<p>如果能有一部大而全的字典，我们都用同一个，世界大同，再也不用担心乱码，多好！</p>
<p>于是，UNICODE来了。</p>
<p>UNICODE是一个世界级的字符集，全世界的每一个字符都有唯一的码点。码点具有这样的形式<code>U+[XX]XXXX</code>，其中，X是一个十六进制数字。UNICODE的范围目前是U+0000~U+10FFFF，超过100万。感觉好任性，还有哪个字符没收录进来~</p>
<p>因为码点太多了，为了方便管理，把每65536个码点归为一组，称为一个平面（Plane），共有17个平面。</p>
<p>第一个平面，即Plane 0，又叫做BMP（Basic Multilingual Plane，基本多语言平面），码点范围是U+0000~U+FFFF，日常用到的绝大多数字符都在这个平面。</p>
<pre><code class="lang-python">&gt;&gt;&gt; u&#39;诗&#39;
u&#39;\u8bd7&#39;
</code></pre>
<p>参考ASCII的编码方法，UNICODE的编码方法也可以如此直接，即直接存储码点对应的二进制。</p>
<p>额，因为UNICODE的码点最少也要4个字节，所以，意味着曾经在ASCII只需要1个字节的字符们要占用4个字节了，并且，这还和ASCII不兼容。</p>
<p>我们千辛万苦找到UNICODE，却又遇不兼容和占空间的问题，好忧伤啊。</p>
<p>但这也不能怪UNICODE，人家是字符集，只是查个码点，具体如何编码到计算机是不管的。</p>
<h3 id="3-2-utf-xxx">3.2 UTF-XXX</h3>
<p>UTF（Unicode Transformation Format），即UNICODE的码点转换为最终的编码的格式。出于不同的目的，有多种UTF编码方法：UTF-8、UTF-16、UTF-32。</p>
<p>其中，UTF-32便是直接将码点转换为4字节二进制的方法。</p>
<p>考虑到大多数人都在BMP（U+0000~U+FFFF）里玩，只需要使用两个字节编码即可。万一用到了BMP以外的字符，再使用4字节。这便是UTF-16。</p>
<p>由于UTF-16和UTF-32使用多个字节来存储一个数字（码点），所以都需要考虑字节序的问题。</p>
<p>UTF-8不同于UTF-16、UTF-32，UTF-8是一种变长字节的编码方式，无需考虑字节序。对于汉字“诗”，其UTF-8编码计算方式如下。</p>
<p><img src="/drafts/categories/weixin/images/utf8-example.png" alt=""></p>
<p>对于字符“a”，对应的UNICODE码点、UTF-XXX编码为：</p>
<pre><code>CHAR   : a
UNICODE: u+0061
UTF-8  : 0x61
UTF-16 : 0x0061
UTF-32 : 0x00000061
</code></pre><p>对于字符“诗”，对应的UNICODE码点、UTF-XXX编码为：</p>
<pre><code>CHAR   : 诗
UNICODE: u+8bd7
UTF-8  : 0xe8af97
UTF-16 : 0x8bd7
UTF-32 : 0x00008bd7
</code></pre><p>世界还是很美好的，尽管还有一波GBXXX的接口在跑着，不支持4字节UTF-8的MySQL在跑着，老的NodeJS在跑着...</p>
<p>这种感觉就像住在老破小里，看着宏伟的城市蓝图。</p>
<p>不对，是租住（逃</p>
<h2 id="-">参考</h2>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/计算机编码">https://zh.wikipedia.org/wiki/计算机编码</a></li>
<li><a href="https://en.wikipedia.org/wiki/Character_encoding">https://en.wikipedia.org/wiki/Character_encoding</a></li>
<li><a href="http://cenalulu.github.io/linux/character-encoding/">http://cenalulu.github.io/linux/character-encoding/</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/12/unicode.html">http://www.ruanyifeng.com/blog/2014/12/unicode.html</a></li>
<li><a href="http://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html">http://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html</a></li>
<li><a href="https://www.w3.org/International/questions/qa-what-is-encoding">https://www.w3.org/International/questions/qa-what-is-encoding</a></li>
<li><a href="https://en.wikipedia.org/wiki/Code_page">https://en.wikipedia.org/wiki/Code_page</a></li>
<li><a href="https://zh.wikipedia.org/wiki/代码页">https://zh.wikipedia.org/wiki/代码页</a></li>
<li><a href="https://blogs.msdn.microsoft.com/shawnste/2005/03/15/whats-the-difference-between-an-encoding-code-page-character-set-and-unicode/">https://blogs.msdn.microsoft.com/shawnste/2005/03/15/whats-the-difference-between-an-encoding-code-page-character-set-and-unicode/</a></li>
<li><a href="https://my.oschina.net/goldenshaw/blog/352859">https://my.oschina.net/goldenshaw/blog/352859</a></li>
<li><a href="https://en.wikipedia.org/wiki/Unicode">https://en.wikipedia.org/wiki/Unicode</a></li>
<li><a href="https://my.oschina.net/goldenshaw/blog/310331">https://my.oschina.net/goldenshaw/blog/310331</a></li>
</ul>

        </div>
        <div id="disqus_thread"></div>
      </div>
    </article>
  </section>
</div>
        <footer id="footer">
          <div class="outer">
            <div id="footer-info" class="inner">
              © 2017 zhangxiaoyang.me
              <br>
              Powered by
              <a href="https://github.com/zhangxiaoyang/fow" target="_blank">
                Fow
              </a>
            </div>
          </div>
        </footer>
      </div>
      <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
      <script src="/themes/default/js/jquery.scrollUp.min.js" type="text/javascript"></script>
      <script src="/themes/default/js/jquery.transform.js" type="text/javascript"></script>
      <script src="/themes/default/js/menu.js" type="text/javascript"></script>
      <script src="/themes/default/js/script.js" type="text/javascript"></script>
      <script src="/themes/default/js/scrollUp.js" type="text/javascript"></script>
      <script src="/themes/default/js/prettify.js" type="text/javascript"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<script type="text/javascript">
$(window).load(function(){
  $('pre').addClass('prettyprint linenums');
  prettyPrint();
});
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    jax: ["input/TeX", "output/SVG"],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],        
    inlineMath: [ ['$','$'], ['\\(','\\)'] ],
    displayMath: [ ['$$','$$'], ['\\[','\\]'] ]
  }
});
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script type="text/javascript">
  $('.article-entry img').click(function() {
    window.open($(this).attr('src'), '_blank');
  });
</script>

<script>
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//zhangxiaoyang-me.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html>

