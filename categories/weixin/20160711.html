<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="description" content="Yang的后花园，爱美工的程序员，zhangxiaoyang"/>
    <meta name="keywords" content="学习，思考，想法"/>
    <meta name="author" content="zhangxiaoyang"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <title>Yang的后花园</title>
    <link rel="shortcut icon" href="/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="/themes/default/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <meta name="google-site-verification" content="Fjy6iUBWNJ0NBNFFzR8ZxFrkCxJ9rvHeBBYPyue-HBw"/>
<link rel="stylesheet" type="text/css" href="/themes/default/css/scrollUp.css"/>
<link rel="stylesheet" type="text/css" href="/themes/default/css/prettify-solarized-dark.css"/>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?661930a9db32b395d0caee1a2c022527";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46826647-1', 'auto');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div id="container">
      <div id="wrap">
        <header id="header">
          <div id="banner" style="background: url(http://ww3.sinaimg.cn/large/005X3nNxjw1epeyfkp54aj30sg0fr0tj.jpg) no-repeat center center; background-size: cover;">
          </div>
          <div id="header-outer" class="outer">
            <div id="header-title" class="inner">
              <div class="logo">
                <img src="https://avatars3.githubusercontent.com/u/2735163?v=3&amp;s=460" alt="Profile Picture">
              </div>
              <div id="title">
                爱美工的程序员
              </div>
              <ul class="my-navigation">
                
                <li>
                  <a href="/index.html" title="Home">
                  <i class="fa fa-home" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
                <li>
                  <a href="/category.html" title="Category">
                  <i class="fa fa-th-large" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
                <li>
                  <a href="/about.html" title="About">
                  <i class="fa fa-user" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
                <li>
                  <a href="/rss.xml" title="RSS">
                  <i class="fa fa-rss" style="color: #3369e8;"> </i>
                  </a>
                </li>
                
              </ul>
            </div>
          </div>
          <div id="header-inner" class="">
            <nav id="title-nav" style="display: none;">
              <span id="title-nav-items">
                
                  <a href="/index.html" title="Home">
                    <i class="fa fa-home"></i>
                  </a>
                
                  <a href="/category.html" title="Category">
                    <i class="fa fa-th-large"></i>
                  </a>
                
                  <a href="/about.html" title="About">
                    <i class="fa fa-user"></i>
                  </a>
                
                  <a href="/rss.xml" title="RSS">
                    <i class="fa fa-rss"></i>
                  </a>
                
              </span>
            </nav>
            <nav id="sub-nav">
              <a id="nav-search-btn" class="nav-icon" title="Search">
              </a>
            </nav>
            <div id="search-form-wrap">
              <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8"
              class="search-form">
                <input type="search" name="word" maxlength="20" class="search-form-input"
                placeholder="搜索">
                <input type="submit" value="" class="search-form-submit">
                <input name="tn" type="hidden" value="bds">
                <input name="cl" type="hidden" value="3">
                <input name="ct" type="hidden" value="2097152">
                <input type="hidden" name="si" value="zhangxiaoyang.me">
              </form>
            </div>
          </div>
        </header>

<div class="outer">
  <section id="main">
    <article id="weixin/20160711" class="article article-type-post"
    itemscope="" itemprop="blogPost">
      <div class="article-inner">
        <header class="article-header">
          <h1 itemprop="name">
            <a class="article-title" href="/categories/weixin/20160711.html">
              在Windows里使用Docker
            </a>
          </h1>
        </header>
        <footer class="article-footer">
          <ul class="article-time-list">
            <li class="article-time-list-item">
              <a class="article-time-list-link" href="/archive.html">
                2016-07-11 21:52:00
              </a>
            </li>
          </ul>
          <br/>
          <ul class="article-category-list">
            <li class="article-category-list-item">
              <a class="article-category-list-link" href="/category.html">
                微信备份
              </a>
            </li>
          </ul>
          <br/>
          <ul class="article-tag-list">
            
              <li class="article-tag-list-item">
                <a class="article-tag-list-link" href="/tag.html">
                  docker
                </a>
              </li>
            
          </ul>
        </footer>
        <div class="article-entry" itemprop="articleBody">
          <div class="article-abstract"><p><img src="/drafts/categories/weixin/images/docker-windows.jpg" alt=""></p>
<p>Docker才是真爱啊。</p>
</div>
<h2 id="1-">1 曾经的双系统</h2>
<p>对于初学Linux的同学，装双系统是一个很大的挑战。下载镜像、上谷歌、上不去谷歌、试各种方法、终于上去了、开始找镜像、下载镜像、刻录光盘、分区、改BIOS启动项顺序、终于装上了、修改引导、改软件源，blablabla。只有经历过的人才懂，精疲力竭。</p>
<p>实际在使用时，也并不舒服。想象一下，正在Linux里愉快的写代码呢，不得不上QQ处理一件事情。好嘛，重启，进Windows。要记得，此刻Linux还开着若干个Terminal，以及N个打开的浏览器Tab页呢！为什么不用QQ for Linux，为什么不用Wine，为什么不用QQ for Web？真心的不好用啊。</p>
<p>再比如，迅雷、Office、Photoshop，这些常用软件在Linux里找不到好的替代品。当然，可以选择Aria2、WPS for Linux，可是并没有原配的好啊。</p>
<p>最终，有人选择了Mac。当聊QQ的时候，调出Terminal是件多么时尚的是事情啊！</p>
<p>再或者，把女朋友的机器拿过来，左手Linux右手Windows，然后装个Synergy，也不失为一种选择。</p>
<p>或者，干脆装个虚拟机吧。</p>
<p>以上是过去式了，现在，我们有了新的选择——Docker。</p>
<h2 id="2-">2 插曲</h2>
<p>Ubuntu on Windows都来了，还要啥自行车！Windows里也可以有Linux Shell了。</p>
<p>体验过的老司机说一下（Win10 14316），现在还不！稳！定！</p>
<p>当时我也是天真烂漫，格掉机器，Terminal弹出的一刹那，眼角湿润了！可是，当我装完了QQ等常用软件后发现，系统出错，各种不兼容。只能用Terminal的Windows，你们用过嘛。据说，更新为14367后，好多问题都解决了，还是先不要试了（逃</p>
<h2 id="3-docker-">3 Docker使用四步曲</h2>
<h3 id="3-1-">3.1 下载与安装</h3>
<p>访问官方地址：<a href="https://www.docker.com/products/docker-toolbox">https://www.docker.com/products/docker-toolbox</a>，下载Windows版本的Docker Toolbox。</p>
<p><img src="/drafts/categories/weixin/images/docker-toolbox.png" alt=""></p>
<p>然后运行安装程序，一路Next即可。</p>
<p><img src="/drafts/categories/weixin/images/docker-setup.png" alt=""></p>
<h3 id="3-2-">3.2 启动</h3>
<p>打开“Docker Quickstart Terminal”即可启动Docker。</p>
<p><img src="/drafts/categories/weixin/images/docker-logo.jpg" alt=""></p>
<p>经过简单的初始化后，会在Terminal中显示以下内容。需要记下绿色的IP地址，这里是“192.168.99.100”。</p>
<p><img src="/drafts/categories/weixin/images/docker-terminal.png" alt=""></p>
<h3 id="3-3-">3.3 使用</h3>
<p>1) Docker自带的Terminal不好用啊，使用Xshell等连接到Docker吧。IP地址使用上一步记来的那个，端口为22，用户名为“docker”，密码为“tcuser”：</p>
<p><img src="/drafts/categories/weixin/images/xshell.jpg" alt=""></p>
<p>2) 拉一个Ubuntu镜像下来，瞬间有了Ubuntu系统有木有：</p>
<pre><code>docker@default:~$ docker pull ubuntu
Using default tag: latest
latest: Pulling from library/ubuntu
90d6565b970a: Pull complete 
40553bdb8474: Pull complete 
c3129e7479ab: Pull complete 
091663bd70db: Pull complete 
Digest: sha256:ba1688fec34f66d8a7ff5b42e6971625d8232c72bf0e38ad06dda10cad157293
Status: Downloaded newer image for ubuntu:latest
</code></pre><p>3) 查看本地有哪些镜像：</p>
<pre><code>docker@default:~$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              cf62323fa025        2 days ago          125 MB
</code></pre><p>4) 使用下载的Ubuntu镜像创建一个“虚拟机”（container，即容器）并进入：</p>
<pre><code>docker@default:~$ docker run -it ubuntu bash
root@20b0f4a7e5a3:/#
</code></pre><p>20b0f4a7e5a3便是创建的容器ID，可以看到，<code>docker@default</code>变成了<code>root@20b0f4a7e5a3</code>，表示我们已经进入到这个容器了。</p>
<p>5) 退出容器（容器将会关闭）：</p>
<pre><code>root@20b0f4a7e5a3:/# exit
exit
docker@default:~$
</code></pre><p>6) 因为容器之前已经创建过了，再次进入无需重复创建，直接启动并进入即可：</p>
<pre><code>docker@default:~$ docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                       PORTS               NAMES
20b0f4a7e5a3        ubuntu              &quot;bash&quot;              6 minutes ago       Exited (130) 7 seconds ago                       furious_sinoussi
docker@default:~$ docker start 2
2
docker@default:~$ docker attach 2
root@20b0f4a7e5a3:/#
</code></pre><p><code>docker ps -a</code>可以查看所有的容器（包括关闭的），不加<code>-a</code>参数，则只查看启动的容器。执行<code>docker attach 2</code>可以进入到容器2中。对了，2是20b0f4a7e5a3的简写，也可以写20、20b、20b等等。</p>
<p>7) <code>exit</code>可以退出并关闭容器。有时候我们只是想短暂离开一下，稍后还会回去。那就不要用<code>exit</code>了，使用以下命令：</p>
<pre><code>root@20b0f4a7e5a3:/# [在容器里执行CTRL+P+Q临时退出容器]
</code></pre><p><code>docker attach 2</code>再次进入容器。</p>
<p>8) 可以在容器里装一些自己常用的软件，比如：</p>
<pre><code>root@20b0f4a7e5a3:/# apt-get install git vim ...
</code></pre><p>9) 备份这个为自己量身定做的容器吧（制作成镜像）：</p>
<pre><code>docker@default:~$ docker export -o myubuntu.tar 2
或
docker@default:~$ docker export 2 &gt; myubuntu.tar
</code></pre><p>10) 还原之前制作的镜像：</p>
<pre><code>docker@default:~$ docker import myubuntu.tar yang/myubuntu
sha256:452310aef4d809bc410cb2d6a699ab39b9040c410a2580cd382eebed1acf6afe
docker@default:~$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
yang/myubuntu       latest              452310aef4d8        2 minutes ago       195 MB
ubuntu              latest              cf62323fa025        2 days ago          125 MB
</code></pre><h3 id="3-4-">3.4 进阶</h3>
<p>1) 有时候我们希望容器在后台运行，而不是直接把命令的结果输出。</p>
<pre><code>docker@default:~$ docker run ubuntu bash -c &#39;while true; do echo &quot;hi&quot;; sleep 1; done&#39;
hi
hi
hi
...
</code></pre><p>以上是我们不希望的，我们希望这样：</p>
<pre><code>docker@default:~$ docker run -d ubuntu bash -c &#39;while true; do echo &quot;hi&quot;; sleep 1; done&#39;
ab6ffafedcbdc70450b8c02b0853534010f68debd7f58b78f46fb2042b857567
docker@default:~$ docker logs -f ab6
hi
hi
hi
...
</code></pre><p><code>docker logs</code>可以获取容器的输出信息。</p>
<p>2) 一个容器可以登入多次，也就是开多个终端连接过去：</p>
<pre><code>docker@default:~$ docker exec -it 20b0f4a7e5a3 bash
</code></pre><p>3) 有时候我们会在容器里起一个服务，比如HTTP。</p>
<p>对于一个已经存在的容器20b0f4a7e5a3，可以这样做：</p>
<pre><code>docker@default:~$ docker stop 20b0f4a7e5a3
docker@default:~$ docker commit 20b0f4a7e5a3 ubuntu01
docker@default:~$ docker run -p 1234:1234 -it ubuntu01 bash
</code></pre><p>如果还未创建容器，则直接可以：</p>
<pre><code>docker@default:~$ docker run -p 1234:1234 -it ubuntu bash
</code></pre><p>然后，需要设置VirtualBox的“网络→端口转发规则”选项：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>协议</th>
<th>主机IP</th>
<th>主机端口</th>
<th>子系统IP</th>
<th>子系统端口</th>
</tr>
</thead>
<tbody>
<tr>
<td>myweb</td>
<td>TCP</td>
<td>127.0.0.1</td>
<td>1234</td>
<td></td>
<td>1234</td>
</tr>
</tbody>
</table>
<p>当容器中启动HTTP服务时，在Windows里访问：<a href="http://192.168.99.100:1234/">http://192.168.99.100:1234/</a>即可。 </p>
<p>4) 尽管Linux中的<code>sz</code>和<code>rz</code>命令可以与Windows互传文件，但还是没有共享一个文件夹来的方便啊。</p>
<p>首先，先在VirtualBox的“共享文件夹→添加共享文件夹”中设置：</p>
<ul>
<li>共享文件夹路径：X:\win_folder</li>
<li>共享文件夹名称：win_folder</li>
<li>假设win_folder里有3个文件：1.txt、test.mp3、2016.jpg</li>
</ul>
<p>然后，在Docker里执行以下命令，把共享文件夹win_folder挂到/home/docker/vm_folder下：</p>
<pre><code>docker@default:~$ mkdir -p /home/docker/vm_folder
docker@default:~$ sudo mount -t vboxsf win_folder /home/docker/vm_folder
</code></pre><p>为了能够让容器访问该共享文件夹，还需要：</p>
<pre><code>docker@default:~$ docker run -it -v /home/docker/vm_folder:/container_folder ubuntu
root@afcf5f504e08:/#
</code></pre><p>其中，<code>-v</code>参数表示创建一个数据卷，并挂载到容器中。好啦，可以在容器里尽情使用啦：</p>
<pre><code>root@afcf5f504e08:/# cd /container_folder/
root@afcf5f504e08:/# ls
1.txt test.mp3 2016.jpg
</code></pre><h2 id="-">参考</h2>
<ul>
<li><a href="http://core0.staticworld.net/images/article/2014/10/docker_windows-100525105-primary.idge.jpg">http://core0.staticworld.net/images/article/2014/10/docker_windows-100525105-primary.idge.jpg</a></li>
<li><a href="https://www.zhihu.com/question/42228124/">https://www.zhihu.com/question/42228124/</a></li>
<li><a href="https://zh.wikipedia.org/zh-cn/Docker_(軟體)">https://zh.wikipedia.org/zh-cn/Docker_(軟體)</a></li>
<li><a href="https://www.gitbook.com/book/yeasy/docker_practice/details">https://www.gitbook.com/book/yeasy/docker_practice/details</a></li>
<li><a href="http://tuhrig.de/mount-windows-folder-to-boot2docker-vm/">http://tuhrig.de/mount-windows-folder-to-boot2docker-vm/</a></li>
</ul>

        </div>
        <div id="disqus_thread"></div>
      </div>
    </article>
  </section>
</div>
        <footer id="footer">
          <div class="outer">
            <div id="footer-info" class="inner">
              © 2017 zhangxiaoyang.me
              <br>
              Powered by
              <a href="https://github.com/zhangxiaoyang/fow" target="_blank">
                Fow
              </a>
            </div>
          </div>
        </footer>
      </div>
      <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
      <script src="/themes/default/js/jquery.scrollUp.min.js" type="text/javascript"></script>
      <script src="/themes/default/js/jquery.transform.js" type="text/javascript"></script>
      <script src="/themes/default/js/menu.js" type="text/javascript"></script>
      <script src="/themes/default/js/script.js" type="text/javascript"></script>
      <script src="/themes/default/js/scrollUp.js" type="text/javascript"></script>
      <script src="/themes/default/js/prettify.js" type="text/javascript"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<script type="text/javascript">
$(window).load(function(){
  $('pre').addClass('prettyprint linenums');
  prettyPrint();
});
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    jax: ["input/TeX", "output/SVG"],
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],        
    inlineMath: [ ['$','$'], ['\\(','\\)'] ],
    displayMath: [ ['$$','$$'], ['\\[','\\]'] ]
  }
});
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script type="text/javascript">
  $('.article-entry img').click(function() {
    window.open($(this).attr('src'), '_blank');
  });
</script>

<script>
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//zhangxiaoyang-me.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html>

